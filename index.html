<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢…èŠ±æ˜“æ•° - æ™ºæ–­ä¹¾å¤è¿›é˜¶ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Serif SC', serif; background-color: #f2efea; color: #2d2d2d; }
        .gua-line { height: 10px; width: 120px; margin: 6px auto; border-radius: 2px; position: relative; }
        .yang { background-color: #333; }
        .yin { display: flex; justify-content: space-between; background: transparent !important; }
        .yin::before, .yin::after { content: ''; height: 100%; width: 45%; background: #333; border-radius: 2px; }
        .active-yao { background-color: #b91c1c !important; box-shadow: 0 0 10px rgba(185, 28, 28, 0.4); }
        .yin.active-yao::before, .yin.active-yao::after { background: #b91c1c; }
        .card { background: rgba(255, 255, 255, 0.95); border: 1px solid #dcd7cf; }
        .section-header { border-left: 4px solid #333; padding-left: 12px; margin-bottom: 1rem; font-weight: bold; }
        .concept-box { background-color: #fdfbf7; border: 1px solid #e2ddd3; }
    </style>
</head>
<body class="min-h-screen py-6 px-4">
    <div class="max-w-4xl mx-auto card p-6 md:p-10 rounded-lg shadow-2xl">
        <header class="text-center mb-10 border-b pb-6">
            <h1 class="text-4xl font-bold text-stone-800 mb-2">æ¢…èŠ±æ˜“æ•° Â· ä½“ç”¨æ–­æ³•</h1>
            <p class="text-stone-500 italic">è§‚è±¡èµ·å¦ Â· æ·±åº¦è§£æ</p>
        </header>
        
        <div class="bg-stone-50 p-6 rounded-xl border border-stone-200 mb-8">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-bold text-stone-600">æ‰€é—®ä½•äº‹</label>
                    <button onclick="randomGua()" class="text-xs text-amber-700 hover:text-amber-900 font-bold border border-amber-700 px-2 py-1 rounded transition">âœ¨ çµæ„Ÿéšæœºèµ·å¦</button>
                </div>
                <input id="question" type="text" placeholder="ä¾‹å¦‚ï¼šä»Šæ—¥è´¢è¿å¦‚ä½•ï¼Ÿ" class="w-full p-3 border border-stone-300 rounded focus:ring-2 focus:ring-stone-400 outline-none">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-2 text-center uppercase">ä¸Šå¦æ•° (ä¸‡ç‰©)</label>
                    <input id="num1" type="number" class="w-full p-3 border rounded text-center focus:ring-2 focus:ring-stone-400 outline-none" placeholder="1-999">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-2 text-center uppercase">ä¸‹å¦æ•° (åœ°ç†)</label>
                    <input id="num2" type="number" class="w-full p-3 border rounded text-center focus:ring-2 focus:ring-stone-400 outline-none" placeholder="1-999">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-2 text-center uppercase">åŠ¨çˆ»æ•° (æ—¶æœº)</label>
                    <input id="num3" type="number" class="w-full p-3 border rounded text-center focus:ring-2 focus:ring-stone-400 outline-none" placeholder="1-999">
                </div>
            </div>
            <button onclick="calculate()" class="w-full bg-stone-800 text-white py-4 rounded font-bold hover:bg-black transition shadow-lg uppercase tracking-widest text-lg">
                æ¨ç®—å‰å‡¶
            </button>
        </div>

        <div id="result" class="hidden space-y-8">
            <div class="space-y-4">
                <div class="p-4 bg-stone-100 border-l-4 border-stone-800 rounded shadow-sm">
                    <span class="text-xs font-bold text-stone-500 uppercase block mb-1">æ‰€é—®ä¹‹äº‹ï¼š</span>
                    <p id="display-question" class="text-xl font-bold text-stone-800"></p>
                </div>
                <div class="p-6 bg-white border-2 border-stone-800 rounded-xl text-center shadow-inner">
                    <div id="luck-level" class="text-3xl font-bold mb-2 text-amber-800"></div>
                    <div id="luck-desc" class="text-stone-600"></div>
                </div>
            </div>

            <div class="p-6 bg-white border border-stone-200 rounded-xl shadow-sm">
                <h4 class="section-header text-xl text-stone-800">å¦è¾æ·±åº¦è§£æ</h4>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-3">
                        <p class="text-xs font-bold text-amber-800 bg-amber-50 px-2 py-1 inline-block rounded">å½“å‰å±€é¢ (ä¸»å¦)</p>
                        <p id="main-modern" class="text-base leading-relaxed text-stone-700"></p>
                    </div>
                    <div class="space-y-3">
                        <p class="text-xs font-bold text-amber-800 bg-amber-50 px-2 py-1 inline-block rounded">æœªæ¥è¶‹å‘ (å˜å¦)</p>
                        <p id="change-modern" class="text-base leading-relaxed text-stone-700"></p>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="text-center p-6 border rounded-xl bg-white">
                    <h3 class="text-stone-400 text-xs mb-4 uppercase tracking-widest">ã€ä¸»å¦ï¼šå½“å‰èƒ½é‡ã€‘</h3>
                    <div id="main-gua-graph" class="py-4"></div>
                    <p id="main-gua-name" class="text-2xl font-bold text-stone-800 mt-2"></p>
                    <p id="main-gua-elements" class="text-sm text-stone-500 mt-1"></p>
                </div>
                <div class="text-center p-6 border rounded-xl bg-white">
                    <h3 class="text-stone-400 text-xs mb-4 uppercase tracking-widest">ã€å˜å¦ï¼šè´¨å˜æ–¹å‘ã€‘</h3>
                    <div id="change-gua-graph" class="py-4"></div>
                    <p id="change-gua-name" class="text-2xl font-bold text-stone-800 mt-2"></p>
                </div>
            </div>

            <div class="p-6 bg-stone-50 border border-stone-200 rounded-xl">
                <h4 class="section-header text-stone-800 mb-6">æ˜“å­¦è®²å ‚ Â· ä½“ç”¨åŸç†è¯´æ˜</h4>
                
                <div class="grid md:grid-cols-2 gap-8 text-sm">
                    <div>
                        <p class="font-bold mb-2 text-stone-700">ä»€ä¹ˆæ˜¯â€œä½“â€ä¸â€œç”¨â€ï¼Ÿ</p>
                        <p class="text-stone-600 leading-relaxed mb-4">
                            åœ¨æ¢…èŠ±æ˜“æ•°ä¸­ï¼Œ<strong>ä½“å¦</strong>ä»£è¡¨ä½ è‡ªå·±ã€æ±‚æµ‹è€…æˆ–ä¸»ä½“ï¼›<strong>ç”¨å¦</strong>ä»£è¡¨ä½ é—®çš„äº‹ã€å¤–éƒ¨ç¯å¢ƒæˆ–å¯¹æ–¹ã€‚
                            <br><br>
                            <strong>åˆ¤å®šè§„åˆ™ï¼š</strong>å¦ç”±ä¸Šä¸‹ä¸¤ä¸ªå…«å¦ç»„æˆï¼ŒåŒ…å«â€œåŠ¨çˆ»â€ï¼ˆå˜åŠ¨çš„çˆ»ï¼‰çš„é‚£åŠéƒ¨åˆ†å°±æ˜¯â€œç”¨å¦â€ï¼Œä¸åŠ¨çš„é‚£åŠéƒ¨åˆ†å°±æ˜¯â€œä½“å¦â€ã€‚
                        </p>
                        <div class="p-4 concept-box rounded italic text-stone-500">
                            <strong>å®æˆ˜ä¾‹å­ï¼š</strong><br>
                            å¦‚æœä½ æ±‚å¾—â€œç«é›·å™¬å—‘â€å¦ï¼ŒåŠ¨çˆ»åœ¨ç¬¬2çˆ»ï¼ˆå±äºä¸‹å¦ï¼‰ã€‚é‚£ä¹ˆï¼š<br>
                            1. åŠ¨çš„ä¸‹å¦â€œéœ‡é›·â€å°±æ˜¯<strong>ç”¨å¦ï¼ˆäº‹ï¼‰</strong>ã€‚<br>
                            2. ä¸åŠ¨çš„ä¸Šå¦â€œç¦»ç«â€å°±æ˜¯<strong>ä½“å¦ï¼ˆæˆ‘ï¼‰</strong>ã€‚<br>
                            3. åˆ¤å®šï¼šä½“å¦ç«æ³„æ°”äºç”¨å¦æœ¨ï¼ˆä½“ç”Ÿç”¨ï¼‰ï¼Œä»£è¡¨æ­¤äº‹è™½ç„¶çœ‹èµ·æ¥çº¢ç«ï¼Œä½†å¯¹è‡ªå·±æŸè€—è¾ƒå¤§ã€‚
                        </div>
                    </div>
                    
                    <div>
                        <p class="font-bold mb-2 text-stone-700">äº”è¡Œç”Ÿå…‹åˆ¤å®šè¡¨</p>
                        <ul class="space-y-2 text-stone-600">
                            <li class="flex justify-between border-b pb-1"><span>ğŸŸ¢ <strong>ç”¨ç”Ÿä½“</strong> (å¤§å‰)</span> <span>äº‹æ¥æˆæˆ‘ï¼Œè´µäººåŠ©</span></li>
                            <li class="flex justify-between border-b pb-1"><span>ğŸŸ¡ <strong>ä½“ç”¨æ¯”å’Œ</strong> (ä¸­å‰)</span> <span>äº”è¡Œç›¸åŒï¼Œé¡ºé‚</span></li>
                            <li class="flex justify-between border-b pb-1"><span>ğŸ”µ <strong>ä½“å…‹ç”¨</strong> (å°å‰)</span> <span>æˆ‘èƒœæ­¤å¦ï¼Œéœ€åŠªåŠ›</span></li>
                            <li class="flex justify-between border-b pb-1"><span>ğŸŸ  <strong>ä½“ç”Ÿç”¨</strong> (å°å‡¶)</span> <span>æ³„æˆ‘ä¹‹æ°”ï¼Œå¤šæŸè€—</span></li>
                            <li class="flex justify-between border-b pb-1"><span>ğŸ”´ <strong>ç”¨å…‹ä½“</strong> (å¤§å‡¶)</span> <span>ç¯å¢ƒå‹åŠ›ï¼Œå—é˜»ç¢</span></li>
                        </ul>
                        <div class="mt-4 p-4 bg-stone-800 text-stone-300 rounded text-xs leading-loose">
                            <p class="font-bold text-stone-100 mb-1">å½“å‰åˆ†æç»“æœï¼š</p>
                            <p id="analysis-tiyong"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const baguaData = {
            1: { name: "ä¹¾", symbol: [1, 1, 1], element: "é‡‘" },
            2: { name: "å…‘", symbol: [1, 1, 0], element: "é‡‘" },
            3: { name: "ç¦»", symbol: [1, 0, 1], element: "ç«" },
            4: { name: "éœ‡", symbol: [1, 0, 0], element: "æœ¨" },
            5: { name: "å·½", symbol: [0, 1, 1], element: "æœ¨" },
            6: { name: "å", symbol: [0, 1, 0], element: "æ°´" },
            7: { name: "è‰®", symbol: [0, 0, 1], element: "åœŸ" },
            8: { name: "å¤", symbol: [0, 0, 0], element: "åœŸ" }
        };

        const gua64Database = {
            "11": { name: "ä¹¾ä¸ºå¤©", modern: "äº‹ä¸šå¦‚æ—¥ä¸­å¤©ï¼Œå…·å¤‡å¤§å‘å±•çš„æ¡ä»¶ã€‚ä½†éœ€è­¦æƒ•ç››æå¿…è¡°ï¼ŒåŠ¡å¿…ä¿æŒè™šå¿ƒã€‚" },
            "88": { name: "å¤ä¸ºåœ°", modern: "å®œå®ˆä¸å®œè¿›ï¼Œåº”é¡ºåº”è‡ªç„¶ã€‚ä»¥æŸ”å…‹åˆšï¼Œåšå¾·è½½ç‰©æ–¹èƒ½æˆåŠŸã€‚" },
            "34": { name: "ç«é›·å™¬å—‘", modern: "æ’é™¤éšœç¢ã€‚éœ€è¦æœæ–­å¤„ç†æ‰éšœç¢ã€‚æ³•å¾‹æ‰‹æ®µæˆ–ä¸¥å‰çš„è§„ç« æ˜¯æœ‰æ•ˆçš„ã€‚" },
            "63": { name: "æ°´ç«æ—¢æµ", modern: "äº‹æƒ…å·²ç»å®Œæˆï¼Œå¤„äºå®Œç¾çš„å¹³è¡¡ã€‚æ­¤æ—¶æœ€é‡è¦çš„æ˜¯ç»´æŒç°çŠ¶ï¼Œè°¨é˜²å˜æ•…ã€‚" },
            "32": { name: "ç«æ³½ç½", modern: "äºŒå¥³åŒå±…ï¼Œå…¶å¿—ä¸åŒã€‚ç›®å‰å®¹æ˜“å‡ºç°å†…éƒ¨çŸ›ç›¾æˆ–ä¿¡ä»»å±æœºï¼Œé€‚åˆå¤„ç†å°äº‹ã€‚" },
            "64": { name: "ç«æ°´æœªæµ", modern: "äº‹æƒ…å°šæœªæˆåŠŸï¼Œå¦‚åŒå°ç‹ç‹¸æ¸¡æ°´æ¹¿äº†å°¾å·´ã€‚åªè¦åšæŒåˆ°æœ€åï¼Œä»æœ‰å¸Œæœ›ã€‚" }
        };

        function randomGua() {
            document.getElementById('num1').value = Math.floor(Math.random() * 999) + 1;
            document.getElementById('num2').value = Math.floor(Math.random() * 999) + 1;
            document.getElementById('num3').value = Math.floor(Math.random() * 999) + 1;
        }

        function getRelationship(tiElement, yongElement) {
            const relations = {
                "é‡‘": { "é‡‘": "æ¯”å’Œ", "æœ¨": "æˆ‘å…‹", "æ°´": "æˆ‘ç”Ÿ", "ç«": "å…‹æˆ‘", "åœŸ": "ç”Ÿæˆ‘" },
                "æœ¨": { "é‡‘": "å…‹æˆ‘", "æœ¨": "æ¯”å’Œ", "æ°´": "ç”Ÿæˆ‘", "ç«": "æˆ‘ç”Ÿ", "åœŸ": "æˆ‘å…‹" },
                "æ°´": { "é‡‘": "ç”Ÿæˆ‘", "æœ¨": "æˆ‘ç”Ÿ", "æ°´": "æ¯”å’Œ", "ç«": "æˆ‘å…‹", "åœŸ": "å…‹æˆ‘" },
                "ç«": { "é‡‘": "æˆ‘å…‹", "æœ¨": "ç”Ÿæˆ‘", "æ°´": "å…‹æˆ‘", "ç«": "æ¯”å’Œ", "åœŸ": "æˆ‘ç”Ÿ" },
                "åœŸ": { "é‡‘": "ç”Ÿæˆ‘", "æœ¨": "å…‹æˆ‘", "æ°´": "æˆ‘å…‹", "ç«": "ç”Ÿæˆ‘", "åœŸ": "æ¯”å’Œ" }
            };
            const rel = relations[tiElement][yongElement];
            const luckMap = {
                "ç”Ÿæˆ‘": { level: "å¤§å‰ Â· ç”¨ç”Ÿä½“", desc: "å¦‚é±¼å¾—æ°´ã€‚ç¯å¢ƒæ­£åœ¨ä¸ºä½ æä¾›èƒ½é‡ï¼Œè´µäººç›¸åŠ©ï¼Œæ‰€è°‹æ˜“æˆã€‚" },
                "æ¯”å’Œ": { level: "ä¸­å‰ Â· ä½“ç”¨æ¯”å’Œ", desc: "åŒèˆŸå…±æµã€‚è‡ªèº«èƒ½åŠ›ä¸ç¯å¢ƒåŒ¹é…ï¼Œé¡ºç†æˆç« ï¼Œå¹³å®‰é¡ºé‚ã€‚" },
                "æˆ‘å…‹": { level: "å°å‰ Â· ä½“å…‹ç”¨", desc: "æŒæ§å±€é¢ã€‚è™½ç„¶è¿‡ç¨‹éœ€è¦è¾›è‹¦æ“åŠ³ã€å…‹æœå›°éš¾ï¼Œä½†æœ€ç»ˆèƒ½è¾¾æˆç›®æ ‡ã€‚" },
                "æˆ‘ç”Ÿ": { level: "å°å‡¶ Â· ä½“ç”Ÿç”¨", desc: "ç²¾åŠ›æµå¤±ã€‚ä½ æ­£åœ¨è¿‡åº¦é€æ”¯è‡ªå·±å»åº”å¯¹æ­¤äº‹ï¼Œä»£è¡¨ä»˜å‡ºå¤šè€Œæ”¶è·å°‘ï¼Œé˜²ç ´è´¢ã€‚" },
                "å…‹æˆ‘": { level: "å¤§å‡¶ Â· ç”¨å…‹ä½“", desc: "è…¹èƒŒå—æ•Œã€‚å¤–åœ¨å‹åŠ›å·¨å¤§ï¼Œäº‹æƒ…çš„å‘å±•å¯¹ä½ æåº¦ä¸åˆ©ï¼Œå»ºè®®åŠæ—¶æ­¢æŸã€‚" }
            };
            return luckMap[rel];
        }

        function findGuaIdBySymbol(symbolArray) {
            for (let id in baguaData) {
                if (baguaData[id].symbol.every((val, index) => val === symbolArray[index])) return id;
            }
            return 1;
        }

        function drawGua(containerId, lowerId, upperId, activeYao = -1) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            const fullYaos = [...baguaData[lowerId].symbol, ...baguaData[upperId].symbol];
            for (let i = 5; i >= 0; i--) {
                const div = document.createElement('div');
                div.className = `gua-line ${fullYaos[i] === 1 ? 'yang' : 'yin'} ${ (i+1) === activeYao ? 'active-yao' : ''}`;
                container.appendChild(div);
            }
            return fullYaos;
        }

        function calculate() {
            const q = document.getElementById('question').value;
            const n1 = parseInt(document.getElementById('num1').value);
            const n2 = parseInt(document.getElementById('num2').value);
            const n3 = parseInt(document.getElementById('num3').value);

            if (!q) return alert("è¯·è¾“å…¥å é—®å†…å®¹");
            if (!n1 || !n2 || !n3) return alert("è¯·è¾“å…¥èµ·å¦æ•°å­—");

            const upId = n1 % 8 === 0 ? 8 : n1 % 8;
            const downId = n2 % 8 === 0 ? 8 : n2 % 8;
            const movingYao = n3 % 6 === 0 ? 6 : n3 % 6;

            document.getElementById('display-question').innerText = q;

            let tiId, yongId;
            if (movingYao <= 3) {
                yongId = downId; tiId = upId;
            } else {
                yongId = upId; tiId = downId;
            }

            const mainYaos = drawGua('main-gua-graph', downId, upId, movingYao);
            document.getElementById('main-gua-name').innerText = baguaData[upId].name + baguaData[downId].name;
            document.getElementById('main-gua-elements').innerText = `${baguaData[upId].name}(${baguaData[upId].element}) / ${baguaData[downId].name}(${baguaData[downId].element})`;

            let changeYaos = [...mainYaos];
            changeYaos[movingYao - 1] = changeYaos[movingYao - 1] === 1 ? 0 : 1;
            const cDownId = findGuaIdBySymbol(changeYaos.slice(0, 3));
            const cUpId = findGuaIdBySymbol(changeYaos.slice(3, 6));
            drawGua('change-gua-graph', cDownId, cUpId);
            document.getElementById('change-gua-name').innerText = baguaData[cUpId].name + baguaData[cDownId].name;

            const res = getRelationship(baguaData[tiId].element, baguaData[yongId].element);
            
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('luck-level').innerText = res.level;
            document.getElementById('luck-desc').innerText = res.desc;
            
            document.getElementById('analysis-tiyong').innerHTML = `
                æ­¤æŒ‚åŠ¨çˆ»åœ¨ ${movingYao} çˆ»ï¼Œæ•…ã€${baguaData[tiId].name}${baguaData[tiId].element}ã€‘ä¸ºä½“ï¼Œã€${baguaData[yongId].name}${baguaData[yongId].element}ã€‘ä¸ºç”¨ã€‚<br>
                å½“å‰èƒ½é‡åˆ¤å®šä¸ºï¼š<strong>${res.level.split(' Â· ')[1]}</strong>ã€‚
            `;

            const mKey = `${upId}${downId}`;
            const cKey = `${cUpId}${cDownId}`;
            document.getElementById('main-modern').innerText = gua64Database[mKey]?.modern || "ä¸»å¦æç¤ºï¼šç›®å‰ç¯å¢ƒå¤„äºä¸€ä¸ªç‰¹å®šçš„å› æœå¾‹ä¸­ï¼Œè¯·ç»“åˆç”Ÿå…‹åˆ¤å®šè°¨æ…è¡ŒåŠ¨ã€‚";
            document.getElementById('change-modern').innerText = gua64Database[cKey]?.modern || "å˜å¦æç¤ºï¼šäº‹ç‰©çš„å‘å±•ç»ˆå°†èµ°å‘æ–°çš„å¹³è¡¡ç‚¹ï¼Œå˜æ•°äº§ç”Ÿåï¼Œç»“æœå¾€å¾€å‡ºäººæ„æ–™ã€‚";

            window.scrollTo({ top: document.getElementById('result').offsetTop - 20, behavior: 'smooth' });
        }
    </script>
</body>
</html>
