<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>梅花易数 - 智断乾坤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Serif SC', serif; background-color: #f2efea; color: #2d2d2d; }
        .gua-line { height: 10px; width: 120px; margin: 6px auto; border-radius: 2px; position: relative; }
        .yang { background-color: #333; }
        .yin { display: flex; justify-content: space-between; background: transparent !important; }
        .yin::before, .yin::after { content: ''; height: 100%; width: 45%; background: #333; border-radius: 2px; }
        .active-yao { background-color: #b91c1c !important; }
        .yin.active-yao::before, .yin.active-yao::after { background: #b91c1c; }
        .card { background: rgba(255, 255, 255, 0.95); border: 1px solid #dcd7cf; }
        .section-title { border-left: 4px solid #333; padding-left: 10px; font-weight: bold; margin-bottom: 1rem; }
    </style>
</head>
<body class="min-h-screen py-6 px-4">
    <div class="max-w-4xl mx-auto card p-6 md:p-10 rounded-lg shadow-2xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-stone-800 mb-2">梅花易数 Web App</h1>
            <p class="text-stone-500 italic">观象起卦 · 洞察先机</p>
        </header>
        
        <div class="bg-stone-50 p-6 rounded-xl border border-stone-200 mb-8">
            <div class="mb-6">
                <label class="block text-sm font-bold text-stone-600 mb-2">问事内容</label>
                <input id="question" type="text" placeholder="请输入您想预测的事项..." 
                    class="w-full p-3 bg-white border border-stone-300 rounded focus:ring-2 focus:ring-stone-400 outline-none transition">
            </div>
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-2 text-center">数字一 (上卦)</label>
                    <input id="num1" type="number" class="w-full p-3 border rounded text-center" placeholder="如 78">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-2 text-center">数字二 (下卦)</label>
                    <input id="num2" type="number" class="w-full p-3 border rounded text-center" placeholder="如 89">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-2 text-center">数字三 (动爻)</label>
                    <input id="num3" type="number" class="w-full p-3 border rounded text-center" placeholder="如 91">
                </div>
            </div>
            <button onclick="calculate()" class="w-full mt-6 bg-stone-800 text-white py-4 rounded font-bold hover:bg-stone-700 transition">
                开启卦盘
            </button>
        </div>

        <div id="result" class="hidden">
            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <div class="text-center p-6 border rounded-xl bg-white shadow-sm">
                    <h3 class="text-stone-400 text-sm mb-4">【主卦：当前状态】</h3>
                    <div id="main-gua-graph" class="py-4"></div>
                    <p id="main-gua-name" class="text-2xl font-bold text-stone-800 mt-2"></p>
                </div>
                <div class="text-center p-6 border rounded-xl bg-white shadow-sm">
                    <h3 class="text-stone-400 text-sm mb-4">【支卦：最终走向】</h3>
                    <div id="change-gua-graph" class="py-4"></div>
                    <p id="change-gua-name" class="text-2xl font-bold text-stone-800 mt-2"></p>
                </div>
            </div>

            <div class="space-y-8">
                <div class="bg-white p-6 rounded-xl border border-stone-200">
                    <div class="section-title text-xl text-stone-800">主卦解析</div>
                    <div class="grid md:grid-cols-2 gap-6 mt-4">
                        <div class="p-4 bg-stone-800 text-stone-100 rounded-lg">
                            <h5 class="font-bold mb-2 text-amber-200 uppercase text-xs">卦辞原文</h5>
                            <p id="main-guaci" class="text-sm leading-relaxed"></p>
                        </div>
                        <div class="p-4 bg-stone-50 text-stone-700 rounded-lg">
                            <h5 class="font-bold mb-2 text-stone-400 uppercase text-xs">白话解析</h5>
                            <p id="main-modern" class="text-sm leading-relaxed"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl border border-stone-200">
                    <div class="section-title text-xl text-stone-800">支卦（变卦）解析</div>
                    <div class="grid md:grid-cols-2 gap-6 mt-4">
                        <div class="p-4 bg-stone-700 text-stone-100 rounded-lg">
                            <h5 class="font-bold mb-2 text-amber-200 uppercase text-xs">卦辞原文</h5>
                            <p id="change-guaci" class="text-sm leading-relaxed"></p>
                        </div>
                        <div class="p-4 bg-stone-50 text-stone-700 rounded-lg">
                            <h5 class="font-bold mb-2 text-stone-400 uppercase text-xs">白话解析</h5>
                            <p id="change-modern" class="text-sm leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 核心八卦符号与名称
        const baguaData = {
            1: { name: "乾", symbol: [1, 1, 1] }, 2: { name: "兑", symbol: [1, 1, 0] },
            3: { name: "离", symbol: [1, 0, 1] }, 4: { name: "震", symbol: [1, 0, 0] },
            5: { name: "巽", symbol: [0, 1, 1] }, 6: { name: "坎", symbol: [0, 1, 0] },
            7: { name: "艮", symbol: [0, 0, 1] }, 8: { name: "坤", symbol: [0, 0, 0] }
        };

        // 64卦完整数据库
        const gua64Database = {
  "11": { "name": "乾为天", "text": "元，亨，利，贞。", "modern": "事业如日中天，具备大发展的条件。但需警惕“亢龙有悔”，务必保持虚心，不可刚愎自用。" },
  "88": { "name": "坤为地", "text": "元，亨，利牝马之贞。", "modern": "此时宜守不宜进，应顺应自然。多听取他人意见，以柔克刚，厚德载物方能成功。" },
  "61": { "name": "水天需", "text": "有孚，光亨，贞吉。利涉大川。", "modern": "时机尚未成熟，需耐心等待。虽然心中焦急，但守正等待终会有好结果。" },
  "16": { "name": "天水讼", "text": "有孚，窒惕，中吉，终凶。", "modern": "容易发生争执或法律纠纷。即便你有理，也建议得饶人处且饶人，和解为上，争斗必有损失。" },
  "87": { "name": "地山谦", "text": "亨，君子有终。", "modern": "谦虚受益。目前形势对你有利，但越是成功越要低调，这样才能获得长久的平安和支持。" },
  "33": { "name": "离为火", "text": "利贞，亨。畜牝牛，吉。", "modern": "光明磊落，事业顺利。要像火一样依附于正道，注意处理好人际关系，不可过于急躁。" },
  "66": { "name": "坎为水", "text": "习坎，有孚，维心亨，行有尚。", "modern": "正处于困难时期，险象环生。需保持内心的诚信与坚定，像水一样持之以恒，终能脱险。" },
  "22": { "name": "兑为泽", "text": "亨，利贞。", "modern": "喜悦交流。适合团队合作、商务洽谈。注意言多必失，不要因为暂时的快乐而放松警惕。" },
  "44": { "name": "震为雷", "text": "亨。震来虩虩，笑言哑哑。", "modern": "会面临突如其来的变动或震惊，但只要内心不乱，这只是虚惊一场，反而能带来反思与进步。" },
  "55": { "name": "巽为风", "text": "小亨，利攸往，利见大人。", "modern": "顺风顺水，适合进行小规模的调整或渗透。建议寻求长辈或专业人士的指导，不宜独断。" },
  "77": { "name": "艮为山", "text": "艮其背，不获其身，行其庭，不见其人，无咎。", "modern": "止步不前。目前不适合行动，应静下心来反思。该停止的时候果断停止，才是最高明的境界。" },
  "12": { "name": "天泽履", "text": "履虎尾，不咥人，亨。", "modern": "如履薄冰。虽然处境有些危险，但只要礼貌待人、遵循规矩，就能化险为夷。" },
  "13": { "name": "天火同人", "text": "同人于野，亨。利涉大川。", "modern": "适合与人合作。走出门去结交朋友，集思广益，共同完成大事业，会有意想不到的收获。" },
  "14": { "name": "天雷无妄", "text": "元，亨，利，贞。其匪正有眚。", "modern": "遵循自然规律，不要有非分之想。只要行事正当，就会好运；如果投机取巧，必遭灾祸。" },
  "15": { "name": "天风姤", "text": "姤，女壮，勿用取女。", "modern": "不期而遇。会遇到突发情况或不寻常的人，要警惕阴柔力量的渗透，不可因一时诱惑而草率决定。" },
  "17": { "name": "天山遁", "text": "亨，小利贞。", "modern": "时运退避。目前形势不利于进攻，应当果断退守，保存实力，等待时机反弹。" },
  "18": { "name": "天地否", "text": "否之匪人，不利君子贞。", "modern": "闭塞不通。上下不和，沟通受阻。此时应深居简出，不宜求职或大规模投资。" },
  "81": { "name": "地天泰", "text": "小往大来，吉亨。", "modern": "三阳开泰。沟通顺畅，事业进入稳定上升期，是开展计划、增加投入的大好时机。" },
  "21": { "name": "泽天夬", "text": "扬于王庭，孚号，有厉。", "modern": "决断之时。虽然优势在你，但处理问题不可过激，要防备小人困兽犹斗，需有周密的计划。" },
  "31": { "name": "火天大有", "text": "元亨。", "modern": "大获丰收。目前财运或事业运极佳，但要记住“满招损”，多做善事，才能长久持有财富。" },
  "41": { "name": "雷天大壮", "text": "利贞。", "modern": "声势浩大，力量强劲。注意不要凭恃力量而鲁莽行事，否则会陷入僵局（羝羊触藩）。" },
  "51": { "name": "风天小畜", "text": "亨。密云不雨，自我西郊。", "modern": "力量尚薄弱，虽然有想法但条件不完全成熟。适合积累资金和人脉，不宜操之过急。" },
  "71": { "name": "山天大畜", "text": "利贞，不家食吉，利涉大川。", "modern": "大有积蓄。不仅是金钱，更指学识与人才。适合远行、求职或启动重大项目。" },
  "28": { "name": "泽地萃", "text": "亨。王假有庙，利见大人。", "modern": "人才聚集。适合参加行业会议、聚会，通过社交活动能遇到贵人，利于团队建设。" },
  "38": { "name": "火地晋", "text": "康侯用锡马蕃庶，昼日三接。", "modern": "加官进爵。你的表现得到了上级的认可，晋升机会就在眼前，宜表现积极，大胆展现才华。" },
  "48": { "name": "雷地豫", "text": "利建侯行师。", "modern": "喜悦顺随。适合制定长远计划或进行娱乐相关的投资。注意不要沉溺于安逸而丧失斗志。" },
  "58": { "name": "风地观", "text": "盥而不荐，有孚颙若。", "modern": "观察与反思。此时不宜动，应多看、多学。通过观察局势，你能发现别人看不见的机遇。" },
  "68": { "name": "水地比", "text": "吉。原筮元永贞，无咎。", "modern": "亲近依附。寻找可靠的合作伙伴或平台。诚信是合作的基础，选对阵营至关重要。" },
  "78": { "name": "山地剥", "text": "不利有攸往。", "modern": "形势严峻，小人得势。你的根基受到威胁，不宜进行任何新计划，应隐忍以待，保全自我。" },
  "23": { "name": "泽火革", "text": "己日乃孚，元亨利贞，悔亡。", "modern": "变革之时。旧的模式已走入死胡同，必须大胆创新、改变现状。虽然开始有阵痛，但结果大吉。" },
  "24": { "name": "泽雷随", "text": "元亨利贞，无咎。", "modern": "随机应变。不要死守己见，跟着时势或强者的脚步走，顺势而为能省力且成功。" },
  "25": { "name": "泽风大过", "text": "栋挠，利有攸往，亨。", "modern": "压力巨大，负担过重。虽然目前情况有些失去平衡，但只要行动果断，就能突破重围。" },
  "26": { "name": "泽水困", "text": "亨，贞，大人吉，无咎。", "modern": "身处困境。钱财或言语受到限制，但这是磨练心性的好机会。保持信心，困境很快会过去。" },
  "27": { "name": "泽山咸", "text": "亨，利贞，取女吉。", "modern": "感应交流。感情运极佳，事业上也容易获得他人的共鸣和支持，凭直觉行事往往是对的。" },
  "32": { "name": "火泽睽", "text": "小事吉。", "modern": "背道而驰。团队内部可能出现分歧。此时不适合做大决策，只能求同存异，处理一些琐事。" },
  "34": { "name": "火雷噬嗑", "text": "亨。利用狱。", "modern": "排除障碍。有阻力干扰，需要像咬碎硬物一样果断处理掉障碍。法律手段或严厉的规章是有效的。" },
  "35": { "name": "火风鼎", "text": "元吉，亨。", "modern": "革故鼎新。事业进入稳固且高水平发展的阶段。适合树立个人品牌或确立新的领导地位。" },
  "36": { "name": "火水未济", "text": "亨，小狐汔济，濡其尾，无攸利。", "modern": "事未完成。虽然接近成功，但最后关头最容易出错。需加倍小心，慎终如始。" },
  "37": { "name": "火山旅", "text": "小亨，旅贞吉。", "modern": "不安定状态。适合出差、外派或副业。虽然目前没有归属感，但只要安守本分，小事可成。" },
  "42": { "name": "雷泽归妹", "text": "征凶，无攸利。", "modern": "顺序混乱。目前的成功可能建立在不正当的基础上。不要被眼前的利益诱惑，长远来看并不乐观。" },
  "43": { "name": "雷火丰", "text": "亨，王假之，勿忧，宜日中。", "modern": "鼎盛时期。财富与名声达到顶峰。但要防备日中则昃，在最好的时候要考虑未来的退路。" },
  "45": { "name": "雷风恒", "text": "亨，无咎，利贞，利有攸往。", "modern": "持之以恒。事业稳定，不需要大的改动。只要坚持既定方针，就能获得长期的成功。" },
  "46": { "name": "雷水解", "text": "利西南，无所往，其来复吉。", "modern": "忧虑解除。困难正在消散，之前的误会或压力将得到释放。适合赦免他人，轻装上阵。" },
  "47": { "name": "雷山小过", "text": "亨，利贞，可小事，不可大事。", "modern": "稍微过度。目前的形势不适合大张旗鼓，可以做些细微的修补工作。保持低调，像小鸟飞行一样。" },
  "52": { "name": "风泽中孚", "text": "豚鱼吉，利涉大川，利贞。", "modern": "诚实守信。内心的真诚能打动他人，甚至能感化对手。适合谈判、签约和深度交流。" },
  "53": { "name": "风火家人", "text": "利女贞。", "modern": "修身齐家。重点应放在内部管理、团队建设或家庭关系上。内稳才能外顺。" },
  "54": { "name": "风雷益", "text": "利有攸往，利涉大川。", "modern": "增益受助。运势上扬，适合积极进取，开展新业务。此时会有贵人相助，事半功倍。" },
  "56": { "name": "风水涣", "text": "亨。王假有庙，利涉大川。", "modern": "散开与化解。虽然有涣散之象，但通过建立共同信念（如企业文化）可以重新凝聚人心，转危为安。" },
  "57": { "name": "风山渐", "text": "女归吉，利贞。", "modern": "循序渐进。事业像树木在山上生长一样缓慢而扎实。不要急功近利，按部就班必有大成。" },
  "62": { "name": "水泽节", "text": "亨。苦节不可贞。", "modern": "节制之道。需要制定规则或节约开支。但要注意度，过分苛刻的节制会导致内部反弹。" },
  "63": { "name": "水火既济", "text": "亨，小利贞。初吉，终乱。", "modern": "大功告成。事情已经达到理想状态。此时最危险的是松懈，必须严防死守，防止滑坡。" },
  "64": { "name": "水雷屯", "text": "元亨利贞。勿用有攸往，利建侯。", "modern": "创业艰难。像种子破土一样充满阻力，不宜轻举妄动。应先理清头绪，寻求帮手。" },
  "65": { "name": "水风井", "text": "改邑不改井，无丧无得。", "modern": "基础稳健。虽然表面环境在变，但核心本质未变。宜深挖潜力，不要频繁更换赛道。" },
  "67": { "name": "水山蹇", "text": "利西南，不利东北。利见大人。", "modern": "寸步难行。前方有大山，后方有深水。此时不宜硬冲，应向西南（平易方向）寻求援手。" },
  "72": { "name": "山泽损", "text": "已日乃孚，元吉，无咎，可贞。", "modern": "先损后益。目前可能需要牺牲一些短期利益或资源，但这会为你赢来长远的信用和回报。" },
  "73": { "name": "山火贲", "text": "亨。小利有攸往。", "modern": "装饰与文明。适合做品牌公关、美化形象。注意不要只做表面文章，内在的实力才是根本。" },
  "74": { "name": "山雷颐", "text": "贞吉。观颐，自求口实。", "modern": "休养生息。关注健康与言语。要注意自己的饮食起居，同时在事业上要寻找自食其力的方法。" },
  "75": { "name": "山风蛊", "text": "元亨，利涉大川。", "modern": "整顿弊端。内部已经积弊已久（像器皿生虫），必须下决心彻底清理改革，才能重获新生。" },
  "76": { "name": "山水蒙", "text": "亨。匪我求童蒙，童蒙求我。", "modern": "启蒙阶段。你或你的团队对现状还很模糊，需要请教老师或专家。保持谦虚的学习心态是关键。" },
  "82": { "name": "地泽临", "text": "元亨利贞。至于八月有凶。", "modern": "好运临头。领导力增强，事业有大进展。但要居安思危，好运不会永远持续，需提前布局。" },
  "83": { "name": "地火明夷", "text": "利艰贞。", "modern": "光明受损。处境艰难，才能被掩盖。此时应“晦藏聪明”，低调行事，保护好自己的初心。" },
  "84": { "name": "地雷复", "text": "亨。出入无疾，朋来无咎。", "modern": "生机重现。最黑暗的时期已过，新的转机已经出现。适合制定新计划，但行动要稳健。" },
  "85": { "name": "地风升", "text": "元亨。利见大人，勿恤。南征吉。", "modern": "稳步上升。运势极佳，适合求职、升迁。只要目标明确，坚持不懈，就能获得显著成功。" },
  "86": { "name": "地水师", "text": "贞，丈人吉，无咎。", "modern": "统帅与竞争。面临重大的竞争或任务。需要严明的纪律和德高望重的领导者，才能克敌制胜。" }
        };

        function findGuaIdBySymbol(symbolArray) {
            for (let id in baguaData) {
                if (baguaData[id].symbol.every((val, index) => val === symbolArray[index])) return id;
            }
            return 1;
        }

        function drawGua(containerId, lowerId, upperId, activeYao = -1) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            const fullYaos = [...baguaData[lowerId].symbol, ...baguaData[upperId].symbol];
            
            for (let i = 5; i >= 0; i--) {
                const div = document.createElement('div');
                const isMoving = (i + 1) === activeYao;
                div.className = `gua-line ${fullYaos[i] === 1 ? 'yang' : 'yin'} ${isMoving ? 'active-yao' : ''}`;
                container.appendChild(div);
            }
            return fullYaos;
        }

        function calculate() {
            const n1 = parseInt(document.getElementById('num1').value);
            const n2 = parseInt(document.getElementById('num2').value);
            const n3 = parseInt(document.getElementById('num3').value);

            if (!n1 || !n2 || !n3) return alert("请输入完整起卦数字");

            const upId = n1 % 8 === 0 ? 8 : n1 % 8;
            const downId = n2 % 8 === 0 ? 8 : n2 % 8;
            const movingYao = n3 % 6 === 0 ? 6 : n3 % 6;

            // 1. 获取主卦
            const mainYaos = drawGua('main-gua-graph', downId, upId, movingYao);
            const mainKey = `${upId}${downId}`;
            const mainInfo = gua64Database[mainKey] || { 
                name: baguaData[upId].name + baguaData[downId].name + "卦", 
                text: "原文参见《周易》。" , 
                modern: "此卦代表当前局势，动爻在" + movingYao + "爻。" 
            };

            // 2. 获取支卦
            let changeYaos = [...mainYaos];
            changeYaos[movingYao - 1] = changeYaos[movingYao - 1] === 1 ? 0 : 1;
            const changeDownId = findGuaIdBySymbol(changeYaos.slice(0, 3));
            const changeUpId = findGuaIdBySymbol(changeYaos.slice(3, 6));
            drawGua('change-gua-graph', changeDownId, changeUpId);

            const changeKey = `${changeUpId}${changeDownId}`;
            const changeInfo = gua64Database[changeKey] || { 
                name: baguaData[changeUpId].name + baguaData[changeDownId].name + "卦", 
                text: "原文参见《周易》。" , 
                modern: "这是事情发展的最终变数。预示着未来环境的变化。" 
            };

            // 3. 填充解析内容
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('main-gua-name').innerText = mainInfo.name;
            document.getElementById('change-gua-name').innerText = changeInfo.name;
            
            document.getElementById('main-guaci').innerText = mainInfo.text;
            document.getElementById('main-modern').innerText = mainInfo.modern;
            
            document.getElementById('change-guaci').innerText = changeInfo.text;
            document.getElementById('change-modern').innerText = changeInfo.modern;

            window.scrollTo({ top: document.getElementById('result').offsetTop - 20, behavior: 'smooth' });
        }
    </script>
</body>
</html>
