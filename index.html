<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢…èŠ±æ˜“æ•° - æ™ºæ–­ä¹¾å¤ç»ˆæç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Serif SC', serif; background-color: #f2efea; color: #2d2d2d; }
        .gua-line { height: 10px; width: 120px; margin: 6px auto; border-radius: 2px; position: relative; }
        .yang { background-color: #333; }
        .yin { display: flex; justify-content: space-between; background: transparent !important; }
        .yin::before, .yin::after { content: ''; height: 100%; width: 45%; background: #333; border-radius: 2px; }
        .active-yao { background-color: #b91c1c !important; box-shadow: 0 0 10px rgba(185, 28, 28, 0.4); }
        .yin.active-yao::before, .yin.active-yao::after { background: #b91c1c; }
        .card { background: rgba(255, 255, 255, 0.95); border: 1px solid #dcd7cf; }
        .section-header { border-left: 4px solid #333; padding-left: 12px; margin-bottom: 1rem; font-weight: bold; }
        .original-text-box { background-color: #2d2a26; color: #e5e1da; padding: 20px; border-radius: 8px; font-style: italic; min-height: 100px; display: flex; align-items: center; justify-content: center; text-align: center; line-height: 1.8; }
    </style>
</head>
<body class="min-h-screen py-6 px-4">
    <div class="max-w-4xl mx-auto card p-6 md:p-10 rounded-lg shadow-2xl">
        <header class="text-center mb-10 border-b pb-6">
            <h1 class="text-4xl font-bold text-stone-800 mb-2">æ¢…èŠ±æ˜“æ•° Â· ä¸“ä¸šæ’ç›˜</h1>
            <p class="text-stone-500 italic">è§‚è±¡èµ·å¦ Â· æ·±åº¦è§£æ Â· ä½“ç”¨ç”Ÿå…‹</p>
        </header>
        
        <div class="bg-stone-50 p-6 rounded-xl border border-stone-200 mb-8">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-bold text-stone-600">æ‰€é—®ä½•äº‹</label>
                    <button onclick="randomGua()" class="text-xs text-amber-700 hover:text-amber-900 font-bold border border-amber-700 px-2 py-1 rounded transition">âœ¨ çµæ„Ÿéšæœºèµ·å¦</button>
                </div>
                <input id="question" type="text" placeholder="è¯·è¾“å…¥æ‚¨æƒ³å é—®çš„äº‹æƒ…..." class="w-full p-3 border border-stone-300 rounded focus:ring-2 focus:ring-stone-400 outline-none">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1 text-center">ä¸Šå¦æ•°</label>
                    <input id="num1" type="number" class="w-full p-3 border rounded text-center outline-none focus:ring-2 focus:ring-stone-400" placeholder="1-999">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1 text-center">ä¸‹å¦æ•°</label>
                    <input id="num2" type="number" class="w-full p-3 border rounded text-center outline-none focus:ring-2 focus:ring-stone-400" placeholder="1-999">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1 text-center">åŠ¨çˆ»æ•°</label>
                    <input id="num3" type="number" class="w-full p-3 border rounded text-center outline-none focus:ring-2 focus:ring-stone-400" placeholder="1-999">
                </div>
            </div>
            <button onclick="calculate()" class="w-full bg-stone-800 text-white py-4 rounded font-bold hover:bg-black transition shadow-lg text-lg">æ¨ç®—ä½“ç”¨ç”Ÿå…‹</button>
        </div>

        <div id="result" class="hidden space-y-8">
            <div class="p-8 bg-white border-2 border-stone-800 rounded-xl text-center shadow-inner">
                <div id="luck-level" class="text-4xl font-bold mb-3 text-amber-800"></div>
                <div id="luck-desc" class="text-stone-600 text-lg"></div>
            </div>

            <div class="p-6 bg-white border border-stone-200 rounded-xl shadow-sm">
                <h4 class="section-header text-xl text-stone-800 mb-6">å¦è¾æ·±åº¦è§£æ</h4>
                <div class="grid md:grid-cols-2 gap-10">
                    <div>
                        <p class="text-xs font-bold text-stone-400 mb-3 uppercase tracking-widest">ã€ä¸»å¦åŸæ–‡ Â· å½“å‰ã€‘</p>
                        <div id="main-original" class="original-text-box mb-4 text-lg"></div>
                        <p class="text-xs font-bold text-amber-800 bg-amber-50 px-2 py-1 inline-block rounded mb-2">ç°ä»£æ–‡è§£æ</p>
                        <p id="main-modern" class="text-sm leading-relaxed text-stone-700"></p>
                    </div>
                    <div class="border-t md:border-t-0 md:border-l md:pl-10 pt-6 md:pt-0">
                        <p class="text-xs font-bold text-stone-400 mb-3 uppercase tracking-widest">ã€æ”¯å¦åŸæ–‡ Â· è¶‹å‘ã€‘</p>
                        <div id="change-original" class="original-text-box mb-4 text-lg"></div>
                        <p class="text-xs font-bold text-amber-800 bg-amber-50 px-2 py-1 inline-block rounded mb-2">æœªæ¥èµ°å‘è§£æ</p>
                        <p id="change-modern" class="text-sm leading-relaxed text-stone-700"></p>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="text-center p-6 border rounded-xl bg-white shadow-sm">
                    <h3 class="text-stone-400 text-xs mb-4 uppercase">ã€ä¸»å¦èƒ½é‡ç»“æ„ã€‘</h3>
                    <div id="main-gua-graph" class="py-4"></div>
                    <p id="main-gua-full-name" class="text-2xl font-bold text-stone-800 mt-2"></p>
                    <div id="main-gua-components" class="text-sm text-stone-500 mt-3 p-3 bg-stone-50 rounded border border-stone-100"></div>
                </div>
                <div class="text-center p-6 border rounded-xl bg-white shadow-sm">
                    <h3 class="text-stone-400 text-xs mb-4 uppercase">ã€æ”¯å¦è´¨å˜èµ°å‘ã€‘</h3>
                    <div id="change-gua-graph" class="py-4"></div>
                    <p id="change-gua-full-name" class="text-2xl font-bold text-stone-800 mt-2"></p>
                    <div id="change-gua-components" class="text-sm text-stone-500 mt-3 p-3 bg-stone-50 rounded border border-stone-100"></div>
                </div>
            </div>

            <div class="p-8 bg-stone-50 border border-stone-200 rounded-xl">
                <h4 class="section-header text-stone-800 mb-6">æ˜“å­¦è®²å ‚ Â· ä½“ç”¨åŸç†è¯´æ˜</h4>
                <div class="grid md:grid-cols-2 gap-10 text-sm">
                    <div>
                        <p class="font-bold mb-3 text-stone-700">ä»€ä¹ˆæ˜¯â€œä½“â€ä¸â€œç”¨â€ï¼Ÿ</p>
                        <p class="text-stone-600 leading-relaxed mb-4">
                            <strong>ä½“å¦</strong>ï¼ˆä¸å«åŠ¨çˆ»è€…ï¼‰ä»£è¡¨æ±‚æµ‹è€…è‡ªå·±ï¼›<strong>ç”¨å¦</strong>ï¼ˆå«æœ‰åŠ¨çˆ»è€…ï¼‰ä»£è¡¨æ‰€å ä¹‹äº‹ã€‚
                        </p>
                        <div id="analysis-tiyong-detail" class="p-5 bg-stone-800 text-stone-200 rounded-lg shadow-inner leading-loose"></div>
                    </div>
                    <div class="space-y-4">
                        <p class="font-bold text-stone-700">äº”è¡Œç”Ÿå…‹å‰å‡¶è¡¨</p>
                        <div class="bg-white p-4 rounded border border-stone-200 shadow-sm">
                            <ul class="space-y-3 text-stone-600">
                                <li class="flex justify-between border-b pb-1 text-green-700 font-bold"><span>ğŸŸ¢ ç”¨ç”Ÿä½“ (å¤§å‰)</span> <span>äº‹æ¥åŠ©æˆ‘</span></li>
                                <li class="flex justify-between border-b pb-1 text-amber-700 font-bold"><span>ğŸŸ¡ ä½“ç”¨æ¯”å’Œ (ä¸­å‰)</span> <span>å’Œè°é¡ºé‚</span></li>
                                <li class="flex justify-between border-b pb-1 text-blue-700"><span>ğŸ”µ ä½“å…‹ç”¨ (å°å‰)</span> <span>è¾›è‹¦ä½†æˆ</span></li>
                                <li class="flex justify-between border-b pb-1 text-orange-700"><span>ğŸŸ  ä½“ç”Ÿç”¨ (å°å‡¶)</span> <span>æ³„æ°”è€—æŸ</span></li>
                                <li class="flex justify-between text-red-700 font-bold"><span>ğŸ”´ ç”¨å…‹ä½“ (å¤§å‡¶)</span> <span>å—å‹å—æŸ</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const baguaData = {
            1: { name: "ä¹¾", symbol: [1, 1, 1], element: "é‡‘", nature: "å¤©" },
            2: { name: "å…‘", symbol: [1, 1, 0], element: "é‡‘", nature: "æ³½" },
            3: { name: "ç¦»", symbol: [1, 0, 1], element: "ç«", nature: "ç«" },
            4: { name: "éœ‡", symbol: [1, 0, 0], element: "æœ¨", nature: "é›·" },
            5: { name: "å·½", symbol: [0, 1, 1], element: "æœ¨", nature: "é£" },
            6: { name: "å", symbol: [0, 1, 0], element: "æ°´", nature: "æ°´" },
            7: { name: "è‰®", symbol: [0, 0, 1], element: "åœŸ", nature: "å±±" },
            8: { name: "å¤", symbol: [0, 0, 0], element: "åœŸ", nature: "åœ°" }
        };

        // 64å¦æ ‡å‡†æ•°æ®åº“ï¼Œç»Ÿä¸€ä½¿ç”¨ text å­—æ®µ
        const gua64Database = {
            "11": { name: "ä¹¾ä¸ºå¤©", text: "ä¹¾ï¼šå…ƒï¼Œäº¨ï¼Œåˆ©ï¼Œè´ã€‚", modern: "å¹¿å¤§äº¨é€šï¼Œåˆšå¥ä¸­æ­£ã€‚å…·å¤‡æˆåŠŸçš„æ¡ä»¶ï¼Œä½†éœ€è­¦æƒ•äº¢é¾™æœ‰æ‚”ã€‚" },
            "88": { name: "å¤ä¸ºåœ°", text: "å¤ï¼šå…ƒï¼Œäº¨ï¼Œåˆ©ç‰é©¬ä¹‹è´ã€‚", modern: "åšå¾·è½½ç‰©ï¼Œæ­¤æ—¶å®œå®ˆä¸å®œè¿›ï¼Œåƒå¤§åœ°ä¸€æ ·åŒ…å®¹æ–¹èƒ½è·å‰ã€‚" },
            "34": { name: "ç«é›·å™¬å—‘", text: "å™¬å—‘ï¼šäº¨ã€‚åˆ©ç”¨ç‹±ã€‚", modern: "æœ‰é˜»ç¢éœ€å¼ºåŠ›æ¸…é™¤ã€‚å¦‚åŒå’¬ç¢ç¡¬ç‰©ä¸€èˆ¬æœæ–­å¤„ç†ï¼Œæ³•å¾‹æ‰‹æ®µæœ‰æ•ˆã€‚" },
            "31": { name: "ç«å¤©å¤§æœ‰", text: "å¤§æœ‰ï¼šå…ƒäº¨ã€‚", modern: "å¦‚æ—¥ä¸­å¤©ï¼Œå¤§è·ä¸°æ”¶ã€‚ç›®å‰è´¢è¿æä½³ï¼Œä½†è¦è®°ä½æ»¡æ‹›æŸï¼Œå¤šåšå–„äº‹ã€‚" }
            // æ­¤å¤„è¯·ç»§ç»­è¡¥å…¨æ‚¨çš„ 64 å¦æ•°æ®
        };

        // éšæœºæŠ½æ•°åŠŸèƒ½
        function randomGua() {
            document.getElementById('num1').value = Math.floor(Math.random() * 999) + 1;
            document.getElementById('num2').value = Math.floor(Math.random() * 999) + 1;
            document.getElementById('num3').value = Math.floor(Math.random() * 999) + 1;
        }

        function findGuaIdBySymbol(symbolArray) {
            for (let id in baguaData) {
                if (baguaData[id].symbol.every((val, index) => val === symbolArray[index])) return id;
            }
            return 1;
        }

        function drawGua(containerId, lowerId, upperId, activeYao = -1) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            const fullYaos = [...baguaData[lowerId].symbol, ...baguaData[upperId].symbol];
            for (let i = 5; i >= 0; i--) {
                const div = document.createElement('div');
                div.className = `gua-line ${fullYaos[i] === 1 ? 'yang' : 'yin'} ${ (i+1) === activeYao ? 'active-yao' : ''}`;
                container.appendChild(div);
            }
            return fullYaos;
        }

        function calculate() {
            const n1 = parseInt(document.getElementById('num1').value);
            const n2 = parseInt(document.getElementById('num2').value);
            const n3 = parseInt(document.getElementById('num3').value);

            if (isNaN(n1) || isNaN(n2) || isNaN(n3)) return alert("è¯·è¾“å…¥å®Œæ•´æ•°å­—ä»¥èµ·å¦");

            const upId = n1 % 8 === 0 ? 8 : n1 % 8;
            const downId = n2 % 8 === 0 ? 8 : n2 % 8;
            const movingYao = n3 % 6 === 0 ? 6 : n3 % 6;

            // 1. å¤„ç†ä¸»å¦
            const mainYaos = drawGua('main-gua-graph', downId, upId, movingYao);
            const mKey = `${upId}${downId}`;
            const mData = gua64Database[mKey] || { name: baguaData[upId].nature + baguaData[downId].nature, text: "å¦è¾åŸæ–‡å¾…å½•å…¥", modern: "æ·±åº¦è§£æå¾…è¡¥å……" };
            
            document.getElementById('main-gua-full-name').innerText = mData.name;
            document.getElementById('main-original').innerText = mData.text;
            document.getElementById('main-modern').innerText = mData.modern;
            document.getElementById('main-gua-components').innerHTML = `ä¸Šå¦ï¼š${baguaData[upId].name}(${baguaData[upId].nature}${baguaData[upId].element}) <br> ä¸‹å¦ï¼š${baguaData[downId].name}(${baguaData[downId].nature}${baguaData[downId].element})`;

            // 2. å¤„ç†æ”¯å¦
            let changeYaos = [...mainYaos];
            changeYaos[movingYao - 1] = changeYaos[movingYao - 1] === 1 ? 0 : 1;
            const cDownId = findGuaIdBySymbol(changeYaos.slice(0, 3));
            const cUpId = findGuaIdBySymbol(changeYaos.slice(3, 6));
            drawGua('change-gua-graph', cDownId, cUpId);
            
            const cKey = `${cUpId}${cDownId}`;
            const cData = gua64Database[cKey] || { name: baguaData[cUpId].nature + baguaData[cDownId].nature, text: "å¦è¾åŸæ–‡å¾…å½•å…¥", modern: "æœªæ¥èµ°å‘è§£æå¾…å½•å…¥" };
            
            document.getElementById('change-gua-full-name').innerText = cData.name;
            document.getElementById('change-original').innerText = cData.text;
            document.getElementById('change-modern').innerText = cData.modern;
            document.getElementById('change-gua-components').innerHTML = `ä¸Šå¦ï¼š${baguaData[cUpId].name}(${baguaData[cUpId].nature}${baguaData[cUpId].element}) <br> ä¸‹å¦ï¼š${baguaData[cDownId].name}(${baguaData[cDownId].nature}${baguaData[cDownId].element})`;

            // 3. ä½“ç”¨åˆ†æ
            let tiId = (movingYao <= 3) ? upId : downId;
            let yongId = (movingYao <= 3) ? downId : upId;
            
            const relations = {
                "é‡‘": { "é‡‘": "æ¯”å’Œ", "æœ¨": "ä½“å…‹ç”¨", "æ°´": "ä½“ç”Ÿç”¨", "ç«": "ç”¨å…‹ä½“", "åœŸ": "ç”¨ç”Ÿä½“" },
                "æœ¨": { "é‡‘": "ç”¨å…‹ä½“", "æœ¨": "æ¯”å’Œ", "æ°´": "ç”¨ç”Ÿä½“", "ç«": "ä½“ç”Ÿç”¨", "åœŸ": "ä½“å…‹ç”¨" },
                "æ°´": { "é‡‘": "ç”¨ç”Ÿä½“", "æœ¨": "ä½“ç”Ÿç”¨", "æ°´": "æ¯”å’Œ", "ç«": "ä½“å…‹ç”¨", "åœŸ": "ç”¨å…‹ä½“" },
                "ç«": { "é‡‘": "ä½“å…‹ç”¨", "æœ¨": "ç”¨ç”Ÿä½“", "æ°´": "ç”¨å…‹ä½“", "ç«": "æ¯”å’Œ", "åœŸ": "ä½“ç”Ÿç”¨" },
                "åœŸ": { "é‡‘": "ä½“ç”Ÿç”¨", "æœ¨": "ç”¨å…‹ä½“", "æ°´": "ä½“å…‹ç”¨", "ç«": "ç”¨ç”Ÿä½“", "åœŸ": "æ¯”å’Œ" }
            };
            
            const rel = relations[baguaData[tiId].element][baguaData[yongId].element];
            const luckMap = {
                "ç”¨ç”Ÿä½“": { l: "å¤§å‰", d: "ç”¨å¦ç”Ÿä½“å¦ï¼Œè´µäººåŠ©æˆ‘ï¼Œé¡ºé£é¡ºæ°´ã€‚" },
                "æ¯”å’Œ": { l: "ä¸­å‰", d: "ä½“ç”¨åŒæ°”ï¼Œå’Œè°ç¨³å®šï¼Œå¹³é¡ºæ— è™ã€‚" },
                "ä½“å…‹ç”¨": { l: "å°å‰", d: "ä½“å…‹åˆ¶ç”¨ï¼Œè™½æœ‰è¾›åŠ³ï¼Œç»ˆå¿…æœ‰è·ã€‚" },
                "ä½“ç”Ÿç”¨": { l: "å°å‡¶", d: "ä½“ç”Ÿç”¨å¦ï¼Œç²¾æ°”ç¥æ³„éœ²ï¼Œé˜²æŸè€—ã€‚" },
                "ç”¨å…‹ä½“": { l: "å¤§å‡¶", d: "ç”¨å¦å…‹ä½“ï¼Œå‹åŠ›æ²‰é‡ï¼Œéœ€é˜²ç¾å„ã€‚" }
            };

            document.getElementById('result').classList.remove('hidden');
            document.getElementById('luck-level').innerText = luckMap[rel].l + " Â· " + rel;
            document.getElementById('luck-desc').innerText = luckMap[rel].d;
            document.getElementById('analysis-tiyong-detail').innerHTML = `
                åŠ¨çˆ»åœ¨ <strong>${movingYao} çˆ»</strong>ï¼šæ•… [${movingYao <= 3 ? 'ä¸‹' : 'ä¸Š'}] å¦ä¸ºç”¨ï¼Œ[${movingYao <= 3 ? 'ä¸Š' : 'ä¸‹'}] å¦ä¸ºä½“ã€‚<br>
                <strong>ä½“å¦</strong>ï¼š${baguaData[tiId].name}(${baguaData[tiId].element}) ä»£è¡¨æ‚¨<br>
                <strong>ç”¨å¦</strong>ï¼š${baguaData[yongId].name}(${baguaData[yongId].element}) ä»£è¡¨äº‹<br>
                <strong>ç»“è®º</strong>ï¼š${rel}ã€‚
            `;

            window.scrollTo({ top: document.getElementById('result').offsetTop - 20, behavior: 'smooth' });
        }
    </script>
</body>
</html>
